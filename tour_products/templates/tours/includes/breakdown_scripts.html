<script type="text/javascript">
    // Disable +/- buttons outside 1-30 range
    function handleEnableDisable(itemId) {
        var currentValue = parseInt(document.getElementById(`id_qty_${itemId}`).value);
        console.log('currentValue')
        var minusDisabled = currentValue <= 0;
        console.log('minusDisabled')
        var plusDisabled = currentValue >= 30;
        console.log('plusDisabled')
        document.getElementById(`minus-qty_${itemId}`).disabled = minusDisabled;
        document.getElementById(`add-qty_${itemId}`).disabled = plusDisabled;
    }

    const addTest = document.querySelector('#add-qty_1');
    const removeTest = document.querySelector('#minus-qty_1');
    addTest.addEventListener('click', addQty);
    removeTest.addEventListener('click', removeQty);
    
    function addQty(event) {
        // event.stopPropagation();
        event.preventDefault();
        const closestInput = event.currentTarget.closest('.input-group').querySelector('.qty_input');
        console.log(closestInput);
        const currentValue = parseInt(closestInput.value);
        console.log(currentValue);
        closestInput.value = currentValue + 1;
        const itemId = event.currentTarget.dataset.item_id;
        console.log(itemId);
        handleEnableDisable(itemId);
    }
    
    function removeQty(event) {
        // event.stopPropagation();
        event.preventDefault();
        const closestInput = event.currentTarget.closest('.input-group').querySelector('.qty_input');
        console.log(closestInput);
        const currentValue = parseInt(closestInput.value);
        console.log(currentValue);
        closestInput.value = currentValue - 1;
        const itemId = event.currentTarget.dataset.item_id;
        console.log(itemId);
        handleEnableDisable(itemId);
    }

    // Ensure proper enabling/disabling of all inputs on page load
    var allQtyInputs = document.getElementsByClassName('qty_input');
    for (var i = 0; i < allQtyInputs.length; i++) {
        var itemId = allQtyInputs[i].dataset.item_id;
        handleEnableDisable(itemId);
    }

    // Check enable/disable every time the input is changed
    document.addEventListener('change', function (event) {
        if (event.target.classList.contains('minus-qty')) {
            var itemId = event.target.dataset.item_id;
            handleEnableDisable(itemId);
        }
    });

    /* Makes key info sticky to top of page */
    window.addEventListener('scroll', function () {
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop || document.body
            .scrollTop || 0;
        const viewportHeight = window.innerHeight || document.documentElement.clientHeight || document.body
            .clientHeight || 0;
        const fixedTour = document.getElementById('fix-tour');

        // Check if the scroll position is greater than the viewport height
        if (scrollPosition > viewportHeight) {
            fixedTour.classList.add('position-fixed', 'top-0', 'start-0');
        } else {
            fixedTour.classList.remove('position-fixed', 'top-0', 'start-0');
        }
    });
</script>